---
import i18next, { changeLanguage, t } from "i18next";
import { getImage } from "@astrojs/image";
import MainLayout from "@web/layouts/MainLayout.astro";
import getCharactersInfo from "@server/actions/GetCharactersInfo";

changeLanguage("en");

const characters = await getCharactersInfo({ language: i18next.language });
//for (const character of characters) {
//    const { src } = await getImage({
//        src: character.portrait,
//        width: "239",
//        height: "338",
//        format: "webp",
//        quality: 100
//    });
//    character.portrait = src;
//}
const capitalize = (str: string) => str.charAt(0).toUpperCase() + str.slice(1);
---
<MainLayout>
	<main id="main" tabindex="-1">
		<section>
			{
				characters.map((character) => (
					<article id={character.slug}>
						<img src={character.portrait} alt={character.name} />
						<div class="text-container">
							<h4>{character.name}</h4>
							<p><span>{t("characters.age")}: </span>{character.age} {t("characters.years-old")}.</p>
							<p><span>{t("characters.likes")}: </span>{capitalize(character.likes.join(", "))}.</p>
							<p><span>{t("characters.dislikes")}: </span>{capitalize(character.dislikes.join(", "))}.</p>
							<p>{character.description}</p>
						</div>
					</article>
				))
			}
		</section>
	</main>
</MainLayout>
<style>
	main {
		width: 862px;

		background-color: var(--background-color-secondary);
		border-radius: var(--border-radius);

		padding: 25px 32px 32px 32px;
	}

	section {
		display: flex;
		flex-direction: column;
		gap: 2px;

		background-color: white;
		border: 1px solid #1d1d1b;
		border-radius: var(--border-radius);

		padding: 24px;
	}

	article {
		display: flex;
		gap: 20px;
	}

	article:nth-child(even) {
		flex-direction: row-reverse;
	}

	img {
		width: 239px;
		min-width: 239px;
		aspect-ratio: 239 / 338;
		border-radius: var(--border-radius);
	}

	.text-container {
		display: flex;
		flex-direction: column;
		padding-top: 16px;
		padding-left: 4px;
		padding-right: 4px;
		gap: 4px;
	}

	h4 {
		font-family: var(--font-family-title);
		font-size: 64px;
		color: var(--color-title);
	}

	p {
		font-family: var(--font-family-text);
		font-size: 16px;
		line-height: 22px;
	}

	span {
		color: var(--color-title);
		font-weight: 600;
	}

	@media (max-width: 992px) {
		main {
			padding: 0;
			width: 100%;
		}

		article {
			flex-direction: column;
		}

		article:nth-child(even) {
			flex-direction: column;
		}

		section {
			border: var(--border);
			gap: 72px;
		}

		article {
			gap: 16px;
		}

		img {
			width: 100%;
		}

		.text-container {
			padding-top: 0;
		}
	}
</style>
